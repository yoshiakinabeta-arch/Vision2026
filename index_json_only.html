<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#f5e6d3">
    <title>My Vision 2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #f5e6d3 0%, #d4a574 100%);
            min-height: 100vh;
            padding: 20px;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        input, textarea {
            -webkit-user-select: text;
            user-select: text;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: #5d4037;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #d4a574 0%, #8d6e63 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
            flex: 1;
            min-width: 120px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #d4a574;
        }

        .stat-label {
            font-size: 0.9em;
            color: #795548;
            margin-top: 5px;
        }

        .category-section {
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .category-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            font-size: 1.5em;
            color: #5d4037;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .category-title-area {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .add-goal-btn {
            padding: 8px 20px;
            background: linear-gradient(135deg, #d4a574 0%, #8d6e63 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.7em;
            cursor: pointer;
            white-space: nowrap;
            transition: opacity 0.3s ease;
        }

        .add-goal-btn:hover {
            opacity: 0.9;
        }

        .category-icon {
            font-size: 1.5em;
        }

        .goals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        .goal-card {
            background: #fafafa;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            position: relative;
            border-left: 4px solid #d4a574;
        }

        .goal-card.completed {
            opacity: 0.7;
            border-left-color: #66bb6a;
        }

        .goal-card.completed .goal-title {
            text-decoration: line-through;
        }

        .goal-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
            background: #ffffff;
        }

        .goal-card:hover .goal-actions {
            opacity: 1;
        }

        .goal-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .goal-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: #66bb6a;
            flex-shrink: 0;
        }

        .goal-content {
            flex: 1;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .goal-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .edit-goal-btn, .delete-goal-btn {
            padding: 5px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8em;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .edit-goal-btn {
            background: #e3f2fd;
            color: #1976d2;
        }

        .edit-goal-btn:hover {
            background: #bbdefb;
        }

        .delete-goal-btn {
            background: #ffebee;
            color: #c62828;
        }

        .delete-goal-btn:hover {
            background: #ffcdd2;
        }

        .goal-icon {
            font-size: 1.8em;
        }

        .goal-title {
            font-size: 1em;
            color: #5d4037;
            font-weight: 500;
            flex: 1;
        }

        .goal-progress {
            margin-top: 10px;
            font-size: 0.85em;
            color: #795548;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-top: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #d4a574 0%, #8d6e63 100%);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 700px;
            width: 100%;
            margin: 20px 0;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .modal-title {
            font-size: 1.8em;
            color: #5d4037;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .close-btn {
            font-size: 2em;
            color: #795548;
            cursor: pointer;
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s ease;
        }

        .close-btn:hover {
            background: #f5f5f5;
        }

        .progress-section {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .progress-text {
            font-size: 1.1em;
            color: #5d4037;
            font-weight: bold;
        }

        .subtask-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.3em;
            color: #5d4037;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .subtask-input-area {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .subtask-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            outline: none;
        }

        .subtask-input:focus {
            border-color: #d4a574;
        }

        .add-btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #d4a574 0%, #8d6e63 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
            white-space: nowrap;
        }

        .add-btn:hover {
            opacity: 0.9;
        }

        .subtask-list {
            list-style: none;
        }

        .subtask-item {
            background: #fafafa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            border-left: 3px solid #d4a574;
            touch-action: none;
        }

        .subtask-item:hover {
            background: #f0f0f0;
        }

        .subtask-item.completed {
            opacity: 0.6;
        }

        .subtask-item.completed .subtask-text {
            text-decoration: line-through;
        }

        .drag-handle {
            cursor: grab;
            font-size: 1.2em;
            color: #999;
            padding: 5px;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .subtask-item.dragging {
            opacity: 0.5;
            background: #e0e0e0;
        }

        .subtask-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #d4a574;
        }

        .subtask-text {
            flex: 1;
            color: #5d4037;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: background 0.2s ease;
        }

        .subtask-text:hover {
            background: #e8e8e8;
        }

        .delete-subtask-btn {
            padding: 6px 12px;
            background: #ffebee;
            color: #c62828;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
        }

        .delete-subtask-btn:hover {
            background: #ffcdd2;
        }

        .subtask-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            overflow-y: auto;
        }

        .subtask-detail-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .subtask-detail-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .memo-textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            margin-bottom: 15px;
        }

        .memo-textarea:focus {
            border-color: #d4a574;
            outline: none;
        }

        .url-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            margin-bottom: 10px;
        }

        .url-input:focus {
            border-color: #d4a574;
            outline: none;
        }

        .url-list {
            margin-top: 15px;
        }

        .url-item {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .url-link {
            flex: 1;
            color: #1976d2;
            text-decoration: none;
            word-break: break-all;
        }

        .url-link:hover {
            text-decoration: underline;
        }

        .delete-url-btn {
            padding: 4px 10px;
            background: #ffebee;
            color: #c62828;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
        }

        .save-memo-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #66bb6a 0%, #43a047 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 15px;
        }

        .save-memo-btn:hover {
            opacity: 0.9;
        }

        .saved-memo-display {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            white-space: pre-wrap;
            color: #5d4037;
            line-height: 1.6;
            border-left: 3px solid #d4a574;
        }

        .data-management-section {
            text-align: center;
            margin-top: 40px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .data-management-title {
            font-size: 1.5em;
            color: #5d4037;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .data-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .data-btn {
            padding: 15px 30px;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            min-width: 180px;
        }

        .data-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.25);
        }

        .data-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .save-btn {
            background: linear-gradient(135deg, #66bb6a 0%, #43a047 100%);
        }

        .export-btn {
            background: linear-gradient(135deg, #42a5f5 0%, #1976d2 100%);
        }

        .import-btn {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
        }

        .data-status-message {
            margin-top: 15px;
            font-size: 0.95em;
            color: #5d4037;
            min-height: 24px;
        }

        .data-status-message.success {
            color: #43a047;
            font-weight: bold;
        }

        .data-status-message.error {
            color: #c62828;
            font-weight: bold;
        }

        .hidden-file-input {
            display: none;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .stats {
                gap: 10px;
            }

            .stat-item {
                min-width: 80px;
            }

            .stat-number {
                font-size: 1.5em;
            }

            .stat-label {
                font-size: 0.75em;
            }

            .category-section {
                padding: 20px 15px;
            }

            .category-header {
                font-size: 1.2em;
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .category-title-area {
                width: 100%;
            }

            .add-goal-btn {
                width: 100%;
                padding: 10px 15px;
                font-size: 0.9em;
            }

            .goals-grid {
                grid-template-columns: 1fr;
            }

            .goal-card {
                padding: 15px;
            }

            .goal-icon {
                font-size: 1.5em;
            }

            .goal-title {
                font-size: 0.95em;
            }

            .goal-actions {
                opacity: 1;
                margin-top: 12px;
            }

            .edit-goal-btn, .delete-goal-btn {
                flex: 1;
                padding: 8px 15px;
            }

            .modal-content {
                padding: 20px 15px;
                margin: 10px;
            }

            .modal-title {
                font-size: 1.3em;
            }

            .subtask-input-area {
                flex-direction: column;
            }

            .add-btn {
                width: 100%;
            }

            .subtask-item {
                padding: 12px;
            }

            .subtask-detail-content {
                padding: 20px 15px;
                margin: 10px;
            }

            .drag-handle {
                font-size: 1.5em;
            }

            .subtask-checkbox {
                width: 24px;
                height: 24px;
            }

            .delete-subtask-btn {
                padding: 8px 12px;
            }

            .data-management-section {
                padding: 20px 15px;
            }

            .data-management-title {
                font-size: 1.2em;
            }

            .data-buttons {
                flex-direction: column;
            }

            .data-btn {
                width: 100%;
                padding: 12px 20px;
                font-size: 1em;
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>My Vision 2026</h1>
            <p>„ÅÇ„Å™„Åü„ÅÆÁõÆÊ®ô„ÇíÂÆüÁèæ„Åó„Çà„ÅÜ</p>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalGoals">0</div>
                    <div class="stat-label">Á∑èÁõÆÊ®ôÊï∞</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="completedGoals">0</div>
                    <div class="stat-label">ÂÆå‰∫ÜÁõÆÊ®ôÊï∞</div>
                </div>
            </div>
        </div>

        <div id="categoriesContainer"></div>

        <div class="data-management-section">
            <h2 class="data-management-title">üìä „Éá„Éº„ÇøÁÆ°ÁêÜ</h2>
            <div class="data-buttons">
                <button class="data-btn save-btn" onclick="manualSave()">üíæ „Éá„Éº„Çø„Çí‰øùÂ≠ò</button>
                <button class="data-btn export-btn" onclick="exportToJSON()">üì§ „Ç®„ÇØ„Çπ„Éù„Éº„Éà (.json)</button>
                <button class="data-btn import-btn" onclick="document.getElementById('importFileInput').click()">üì• „Ç§„É≥„Éù„Éº„Éà (.json)</button>
            </div>
            <input type="file" id="importFileInput" class="hidden-file-input" accept=".json,application/json" onchange="importFromJSON(event)">
            <div class="data-status-message" id="dataStatusMessage"></div>
        </div>
    </div>

    <div class="modal" id="goalModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="goalModalTitle"></h2>
                <button class="close-btn" onclick="closeGoalModal()">√ó</button>
            </div>

            <div class="progress-section">
                <div class="progress-stats">
                    <span class="progress-text" id="progressText">ÈÄ≤Êçó: 0%</span>
                    <span id="progressCount">0 / 0 ÂÆå‰∫Ü</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>

            <div class="subtask-section">
                <h3 class="section-title">üìã „Çµ„Éñ„Çø„Çπ„ÇØ</h3>
                <div class="subtask-input-area">
                    <input type="text" class="subtask-input" id="subtaskInput" placeholder="„Çµ„Éñ„Çø„Çπ„ÇØ„ÇíÂÖ•Âäõ...">
                    <button class="add-btn" onclick="addSubtask()">ËøΩÂä†</button>
                </div>
                <ul class="subtask-list" id="subtaskList"></ul>
            </div>
        </div>
    </div>

    <div class="subtask-detail-modal" id="subtaskDetailModal">
        <div class="subtask-detail-content">
        </div>
    </div>

    <script>
        // ‚ö†Ô∏è ÈáçË¶ÅÔºö„Åì„ÅÆ„Çπ„Éà„É¨„Éº„Ç∏„Ç≠„Éº„ÅØÁµ∂ÂØæ„Å´Â§âÊõ¥„Åó„Å™„ÅÑ„Åì„Å®ÔºÅ
        // Â§âÊõ¥„Åô„Çã„Å®„É¶„Éº„Ç∂„Éº„ÅÆ„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÅåÊ∂à„Åà„Åæ„Åô„ÄÇ
        const STORAGE_KEY = 'vision2026_v2_data';
        const DATA_VERSION = '2.0';
        
        function getDefaultGoalsData() {
            return {
                'travel': {
                    title: 'ÊóÖË°å„Éª‰ΩìÈ®ì',
                    icon: '‚úàÔ∏è',
                    goals: [
                        { id: 'travel1', icon: '‚õ¥Ô∏è', title: '„Éï„Çß„É™„Éº&„Éê„Ç§„ÇØÊóÖË°åÔºà2Ê≥ä3Êó•Ôºâ' },
                        { id: 'travel2', icon: 'üè∞', title: '„Éá„Ç£„Ç∫„Éã„Éº„É©„É≥„Éâ„Éõ„ÉÜ„É´„Å´Ê≥ä„Åæ„Çã' },
                        { id: 'travel3', icon: 'üçï', title: '„Éä„Éù„É™„Å´„Éî„Ç∂„ÇíÈ£ü„Åπ„Å´Ë°å„Åè' },
                        { id: 'travel4', icon: 'üáπüáº', title: 'Âè∞Êπæ„Åß„Ç∞„É´„É°‰∏âÊòß' },
                        { id: 'travel5', icon: 'üåÖ', title: '„Ç¶„É¶„ÉãÂ°©Êπñ„Å´Ë°å„Åè' }
                    ]
                },
                'hobby': {
                    title: 'Ë∂£Âë≥„ÉªÂ≠¶Áøí',
                    icon: 'üé®',
                    goals: [
                        { id: 'hobby1', icon: 'üßµ', title: 'Âà∫Áπç„Åß„Ç´„Çπ„Çø„Éû„Ç§„Ç∫' },
                        { id: 'hobby2', icon: 'üç®', title: '„Éë„Éï„Çß‰ΩêËó§„ÅÆ„Éë„Éï„Çß„Çí‰Ωú„Çã' },
                        { id: 'hobby3', icon: 'üçî', title: '„Ç∞„É´„É°„Éè„É≥„Éê„Éº„Ç¨„Éº„Çí‰Ωú„Çã' },
                        { id: 'hobby4', icon: '‚úçÔ∏è', title: 'Êõ∏ÈÅì„ÅßËá™ÂàÜ„ÇíË°®Áèæ„Åß„Åç„Çã' },
                        { id: 'hobby5', icon: 'üé£', title: '„Ç≠„ÇπÈá£„Çä„Åß20Âåπ„ÄÅ25cm' },
                        { id: 'hobby6', icon: '‚õµ', title: '„Éú„Éº„ÉàÈá£„Çä„Åß„Éí„É©„É°' },
                        { id: 'hobby7', icon: 'üó£Ô∏è', title: 'Êµ∑Â§ñÊóÖË°å„ÅßÊôÆÈÄö„Å´Ëã±‰ºöË©±' },
                        { id: 'hobby8', icon: 'üìú', title: '‰∏≠Â∞è‰ºÅÊ•≠Ë®∫Êñ≠Â£´„ÅÆË≥áÊ†º„ÇíÂèñ„Çã' }
                    ]
                },
                'relationship': {
                    title: '‰∫∫ÈñìÈñ¢‰øÇ',
                    icon: '‚ù§Ô∏è',
                    goals: [
                        { id: 'rel1', icon: 'üòä', title: 'Ëá™ÂàÜ„ÇÇÂë®„Çä„ÇÇÁ¨ëÈ°î„ÅßÈÅé„Åî„Åõ„Çã' },
                        { id: 'rel2', icon: 'üíë', title: 'ÁúüÁêÜÂ≠ê„Åï„Çì„Å´„Äå‰∏ÄÁ∑í„Åß„Çà„Åã„Å£„Åü„Äç„Å®ÊÄù„Å£„Å¶„ÇÇ„Çâ„Åà„Çã' },
                        { id: 'rel3', icon: 'üëß', title: '„Åô„Åø„Çå„Åï„Çì„Å´„ÄåËá™ÂàÜ„Çâ„Åó„Åï„ÇíÁô∫Ë¶ã„Åß„Åç„Åü„Äç„Å®ÊÄù„Å£„Å¶„ÇÇ„Çâ„Åà„Çã' },
                        { id: 'rel4', icon: 'üë®‚Äçüë©‚Äçüë¶', title: '„ÅäÁà∂„Åï„Çì„ÄÅ„ÅäÊØç„Åï„Çì„Å®ÊóÖË°å„Å´Ë°å„Åè' },
                        { id: 'rel5', icon: 'üë¥üëµ', title: 'ÂíåÂ§´„Åï„Çì„ÄÅ„Éà„Ç∑Â≠ê„Åï„Çì„Å®ÊóÖË°åË°å„Åè' },
                        { id: 'rel6', icon: 'üçΩÔ∏è', title: '„ÅÆ„Å∂„Åè„Çì„ÄÅ„ÅäÂßâ„Å°„ÇÉ„Çì„ÇíÊãõ„ÅÑ„Å¶È£ü‰∫ã' }
                    ]
                },
                'health': {
                    title: 'ÂÅ•Â∫∑„ÉªÁæéÂÆπ',
                    icon: 'üí™',
                    goals: [
                        { id: 'health1', icon: '‚öñÔ∏è', title: '68kg„Ç≠„Éº„Éó' },
                        { id: 'health2', icon: 'üí™', title: '6„Éë„ÉÉ„ÇØ' },
                        { id: 'health3', icon: 'üëÄ', title: 'ÁõÆ„ÅÆ‰∏ã„Å´„ÇØ„Éû„Åå„Å™„ÅÑ' }
                    ]
                },
                'career': {
                    title: '‰ªï‰∫ã„Éª„Ç≠„É£„É™„Ç¢',
                    icon: 'üíº',
                    goals: [
                        { id: 'career1', icon: 'ü§ñ', title: 'ÁîüÊàêAI„ÅßÊÉÖÂ†±Êï¥ÁêÜÈù©Êñ∞' },
                        { id: 'career2', icon: 'üìä', title: 'Ëá™ÂàÜ„ÅÆÂñ∂Ê•≠„Çπ„Çø„Ç§„É´„ÅÆÁ¢∫Á´ã' },
                        { id: 'career3', icon: 'ü§ù', title: '„ÅäÂÆ¢„Åï„Åæ„Åã„Çâ„ÅäÂÆ¢„Åï„Åæ„ÇíÁ¥π‰ªã„Åï„Çå„Çã' },
                        { id: 'career4', icon: 'üéØ', title: '‰ºöÁ§æ„ÄÅ‰ª≤Èñì„ÇíÊàêÂäü„Å´Â∞é„Åè' }
                    ]
                },
                'money': {
                    title: 'ÊöÆ„Çâ„Åó„Éª„ÅäÈáë',
                    icon: 'üí∞',
                    goals: [
                        { id: 'money1', icon: 'üí≠', title: 'Â§ß‰∫ã„Å´„Åô„Çã‰æ°ÂÄ§Ë¶≥„ÇíÊòé„Çâ„Åã„Å´„Åô„Çã' },
                        { id: 'money2', icon: 'üíµ', title: 'ÊäïË≥áÊà¶Áï•„Çí‰Ωú„Çä„ÄÅ55Ê≠≥„Åß5,000‰∏áÂÜÜ„ÄÅ63Ê≠≥„Åß1ÂÑÑÂÜÜ' },
                        { id: 'money3', icon: 'üìã', title: 'Ê≠ª„Çì„Å†ÊôÇ„ÅÆÈÄ£Áµ°ÂÖà„ÅÆÂèØË¶ñÂåñ' }
                    ]
                }
            };
        }

        function mergeGoalsData(defaultGoals, savedGoals) {
            if (!savedGoals || typeof savedGoals !== 'object') {
                return defaultGoals;
            }

            const merged = JSON.parse(JSON.stringify(defaultGoals));
            Object.keys(savedGoals).forEach(categoryKey => {
                if (!merged[categoryKey]) {
                    merged[categoryKey] = savedGoals[categoryKey];
                    return;
                }

                const savedCategory = savedGoals[categoryKey];
                merged[categoryKey] = {
                    title: savedCategory.title || merged[categoryKey].title,
                    icon: savedCategory.icon || merged[categoryKey].icon,
                    goals: Array.isArray(savedCategory.goals)
                        ? savedCategory.goals
                        : merged[categoryKey].goals
                };
            });

            return merged;
        }

        let goalsData = getDefaultGoalsData();
        let appData = {};
        let currentGoal = null;
        let currentSubtaskIndex = null;

        function loadData() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const parsed = JSON.parse(saved);
                    if (parsed && parsed.appData) {
                        appData = parsed.appData;
                        goalsData = mergeGoalsData(getDefaultGoalsData(), parsed.goalsData);
                        console.log('‚úÖ „Éá„Éº„Çø„ÇíÊ≠£Â∏∏„Å´„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü:', Object.keys(appData).length, 'ÂÄã„ÅÆÁõÆÊ®ô');
                    } else {
                        appData = parsed;
                        goalsData = getDefaultGoalsData();
                        console.log('‚úÖ „Éá„Éº„Çø„ÇíÊ≠£Â∏∏„Å´„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü:', Object.keys(appData).length, 'ÂÄã„ÅÆÁõÆÊ®ô');
                    }
                } else {
                    console.log('‚ÑπÔ∏è ÂàùÂõûËµ∑Âãï: Êñ∞„Åó„ÅÑ„Éá„Éº„Çø„ÇíÂàùÊúüÂåñ');
                    appData = {};
                    goalsData = getDefaultGoalsData();
                }
            } catch (error) {
                console.error('‚ùå „Éá„Éº„Çø„ÅÆ„É≠„Éº„Éâ„Å´Â§±Êïó:', error);
                appData = {};
                goalsData = getDefaultGoalsData();
            }
        }

        function saveData() {
            try {
                const payload = {
                    version: DATA_VERSION,
                    goalsData,
                    appData
                };
                const dataString = JSON.stringify(payload);
                const dataSizeKB = (new Blob([dataString]).size / 1024).toFixed(2);
                
                if (dataString.length > 5 * 1024 * 1024) {
                    console.error('‚ùå „Éá„Éº„Çø„Çµ„Ç§„Ç∫„ÅåÂ§ß„Åç„Åô„Åé„Åæ„Åô:', dataSizeKB, 'KB');
                    alert('„Éá„Éº„Çø„Çµ„Ç§„Ç∫„ÅåÂ§ß„Åç„Åô„Åé„Çã„Åü„ÇÅ‰øùÂ≠ò„Åß„Åç„Åæ„Åõ„Çì„ÄÇ‰∏ÄÈÉ®„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return false;
                }
                
                localStorage.setItem(STORAGE_KEY, dataString);
                
                const verification = localStorage.getItem(STORAGE_KEY);
                if (verification === dataString) {
                    console.log('‚úÖ „Éá„Éº„Çø„ÇíÊ≠£Â∏∏„Å´‰øùÂ≠ò„Åó„Åæ„Åó„Åü:', dataSizeKB, 'KB,', Object.keys(appData).length, 'ÂÄã„ÅÆÁõÆÊ®ô');
                    return true;
                } else {
                    console.error('‚ùå ‰øùÂ≠ò„ÅÆÊ§úË®º„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                    alert('„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÂÜçÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return false;
                }
            } catch (error) {
                console.error('‚ùå „Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó:', error);
                if (error.name === 'QuotaExceededError') {
                    alert('„Çπ„Éà„É¨„Éº„Ç∏„ÅÆÂÆπÈáè„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ‰∏ÄÈÉ®„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                } else {
                    alert('„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
                }
                return false;
            }
        }

        function manualSave() {
            const statusElement = document.getElementById('dataStatusMessage');
            statusElement.textContent = '‰øùÂ≠ò‰∏≠...';
            statusElement.className = 'data-status-message';
            
            setTimeout(() => {
                const success = saveData();
                
                if (success) {
                    statusElement.textContent = '‚úÖ „Éá„Éº„Çø„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ';
                    statusElement.className = 'data-status-message success';
                } else {
                    statusElement.textContent = '‚ùå ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ';
                    statusElement.className = 'data-status-message error';
                }
                
                setTimeout(() => {
                    statusElement.textContent = '';
                    statusElement.className = 'data-status-message';
                }, 3000);
            }, 300);
        }

        function exportToJSON() {
            try {
                const exportData = {
                    version: DATA_VERSION,
                    exportDate: new Date().toISOString(),
                    goalsData,
                    appData
                };
                
                const jsonString = JSON.stringify(exportData, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json;charset=utf-8;' });
                const link = document.createElement('a');
                const fileName = `my-vision-2026_${new Date().toISOString().split('T')[0]}.json`;
                link.href = URL.createObjectURL(blob);
                link.download = fileName;
                link.click();
                URL.revokeObjectURL(link.href);
                
                const statusElement = document.getElementById('dataStatusMessage');
                statusElement.textContent = `‚úÖ „Ç®„ÇØ„Çπ„Éù„Éº„ÉàÂÆå‰∫Ü: ${fileName}`;
                statusElement.className = 'data-status-message success';
                
                setTimeout(() => {
                    statusElement.textContent = '';
                    statusElement.className = 'data-status-message';
                }, 5000);
                
                console.log('‚úÖ JSON„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÊàêÂäü');
            } catch (error) {
                console.error('‚ùå „Ç®„ÇØ„Çπ„Éù„Éº„Éà„Ç®„É©„Éº:', error);
                const statusElement = document.getElementById('dataStatusMessage');
                statusElement.textContent = '‚ùå „Ç®„ÇØ„Çπ„Éù„Éº„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message;
                statusElement.className = 'data-status-message error';
            }
        }

        function importFromJSON(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const importedData = JSON.parse(content);
                    
                    // „Éá„Éº„ÇøÂΩ¢Âºè„ÅÆÊ§úË®º
                    const dataToImport = importedData.appData || importedData.data;
                    if (!dataToImport || typeof dataToImport !== 'object') {
                        throw new Error('ÁÑ°Âäπ„Å™„Éá„Éº„ÇøÂΩ¢Âºè„Åß„Åô');
                    }

                    const goalsToImport = importedData.goalsData;
                    const goalCount = Object.keys(dataToImport).length;
                    
                    const confirmMsg = `${goalCount}ÂÄã„ÅÆÁõÆÊ®ô„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü„ÄÇ\nÁèæÂú®„ÅÆ„Éá„Éº„Çø„Å´‰∏äÊõ∏„Åç„Åó„Åæ„Åô„ÅãÔºü`;
                    if (confirm(confirmMsg)) {
                        // „Éá„Éº„Çø„Çí„Éû„Éº„Ç∏
                        Object.keys(dataToImport).forEach(goalId => {
                            appData[goalId] = dataToImport[goalId];
                        });

                        if (goalsToImport) {
                            goalsData = mergeGoalsData(getDefaultGoalsData(), goalsToImport);
                        }
                        
                        saveData();
                        renderCategories();
                        
                        const statusElement = document.getElementById('dataStatusMessage');
                        statusElement.textContent = `‚úÖ „Ç§„É≥„Éù„Éº„ÉàÊàêÂäü: ${goalCount}ÂÄã„ÅÆÁõÆÊ®ô`;
                        statusElement.className = 'data-status-message success';
                        
                        setTimeout(() => {
                            statusElement.textContent = '';
                            statusElement.className = 'data-status-message';
                        }, 5000);
                        
                        console.log('‚úÖ „Ç§„É≥„Éù„Éº„ÉàÊàêÂäü:', goalCount, 'ÂÄã„ÅÆÁõÆÊ®ô');
                    }
                    
                } catch (error) {
                    console.error('‚ùå „Ç§„É≥„Éù„Éº„Éà„Ç®„É©„Éº:', error);
                    const statusElement = document.getElementById('dataStatusMessage');
                    statusElement.textContent = '‚ùå „Ç§„É≥„Éù„Éº„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message;
                    statusElement.className = 'data-status-message error';
                    
                    setTimeout(() => {
                        statusElement.textContent = '';
                        statusElement.className = 'data-status-message';
                    }, 5000);
                }
                
                event.target.value = '';
            };
            
            reader.onerror = function() {
                const statusElement = document.getElementById('dataStatusMessage');
                statusElement.textContent = '‚ùå „Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü';
                statusElement.className = 'data-status-message error';
            };
            
            reader.readAsText(file, 'UTF-8');
        }

        function renderCategories() {
            const container = document.getElementById('categoriesContainer');
            container.innerHTML = '';

            Object.keys(goalsData).forEach(catKey => {
                const category = goalsData[catKey];
                
                const section = document.createElement('div');
                section.className = 'category-section';
                
                const header = document.createElement('div');
                header.className = 'category-header';
                header.innerHTML = `
                    <div class="category-title-area">
                        <span class="category-icon">${category.icon}</span>
                        <span>${category.title}</span>
                    </div>
                    <button class="add-goal-btn" onclick="addGoal('${catKey}')">Ôºã ÁõÆÊ®ô„ÇíËøΩÂä†</button>
                `;
                
                const grid = document.createElement('div');
                grid.className = 'goals-grid';
                
                category.goals.forEach(goal => {
                    if (!appData[goal.id]) {
                        appData[goal.id] = { subtasks: [], completed: false };
                    }
                    const data = appData[goal.id];
                    const totalSubtasks = data.subtasks.length;
                    const completedSubtasks = data.subtasks.filter(st => st.completed).length;
                    const progress = totalSubtasks > 0 ? Math.round((completedSubtasks / totalSubtasks) * 100) : 0;
                    
                    const card = document.createElement('div');
                    card.className = `goal-card ${data.completed ? 'completed' : ''}`;
                    card.innerHTML = `
                        <div class="goal-header">
                            <input type="checkbox" class="goal-checkbox" ${data.completed ? 'checked' : ''} 
                                   onclick="toggleGoalComplete('${goal.id}')">
                            <div class="goal-content" onclick="openGoalModal('${goal.id}')">
                                <span class="goal-icon">${goal.icon}</span>
                                <span class="goal-title">${goal.title}</span>
                            </div>
                        </div>
                        <div class="goal-progress">
                            ${completedSubtasks} / ${totalSubtasks} „Çµ„Éñ„Çø„Çπ„ÇØÂÆå‰∫Ü
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        <div class="goal-actions">
                            <button class="edit-goal-btn" onclick="event.stopPropagation(); editGoal('${catKey}', '${goal.id}')">Á∑®ÈõÜ</button>
                            <button class="delete-goal-btn" onclick="event.stopPropagation(); deleteGoal('${catKey}', '${goal.id}')">ÂâäÈô§</button>
                        </div>
                    `;
                    grid.appendChild(card);
                });
                
                section.appendChild(header);
                section.appendChild(grid);
                container.appendChild(section);
            });
            
            updateStats();
        }

        function openGoalModal(goalId) {
            let foundGoal = null;
            Object.values(goalsData).forEach(cat => {
                const goal = cat.goals.find(g => g.id === goalId);
                if (goal) foundGoal = goal;
            });
            
            if (!foundGoal) return;
            
            currentGoal = foundGoal;
            document.getElementById('goalModalTitle').innerHTML = `${foundGoal.icon} ${foundGoal.title}`;
            
            if (!appData[foundGoal.id]) {
                appData[foundGoal.id] = { subtasks: [], completed: false };
            }
            
            renderSubtasks();
            updateProgress();
            document.getElementById('goalModal').classList.add('active');
        }

        function closeGoalModal() {
            document.getElementById('goalModal').classList.remove('active');
            currentGoal = null;
            renderCategories();
        }

        function renderSubtasks() {
            const list = document.getElementById('subtaskList');
            list.innerHTML = '';
            
            const subtasks = appData[currentGoal.id].subtasks;
            
            subtasks.forEach((subtask, index) => {
                const li = document.createElement('li');
                li.className = `subtask-item ${subtask.completed ? 'completed' : ''}`;
                li.draggable = true;
                li.dataset.index = index;
                
                li.innerHTML = `
                    <span class="drag-handle" data-index="${index}">‚ãÆ‚ãÆ</span>
                    <input type="checkbox" class="subtask-checkbox" ${subtask.completed ? 'checked' : ''} data-index="${index}">
                    <span class="subtask-text" data-index="${index}">${subtask.text}</span>
                    <button class="delete-subtask-btn" data-index="${index}">ÂâäÈô§</button>
                `;
                
                list.appendChild(li);
            });
            
            list.addEventListener('change', (e) => {
                if (e.target.classList.contains('subtask-checkbox')) {
                    const index = parseInt(e.target.dataset.index);
                    toggleSubtask(index);
                }
            });
            
            list.addEventListener('click', (e) => {
                if (e.target.classList.contains('subtask-text')) {
                    const index = parseInt(e.target.dataset.index);
                    openSubtaskDetail(index);
                }
                if (e.target.classList.contains('delete-subtask-btn')) {
                    e.stopPropagation();
                    const index = parseInt(e.target.dataset.index);
                    deleteSubtask(index);
                }
            });
            
            const items = list.querySelectorAll('.subtask-item');
            items.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
                item.addEventListener('dragend', handleDragEnd);
            });
        }

        function addSubtask() {
            const input = document.getElementById('subtaskInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            appData[currentGoal.id].subtasks.push({
                text: text,
                completed: false,
                memo: '',
                urls: []
            });
            
            saveData();
            renderSubtasks();
            updateProgress();
            input.value = '';
        }

        function toggleSubtask(index) {
            appData[currentGoal.id].subtasks[index].completed = 
                !appData[currentGoal.id].subtasks[index].completed;
            saveData();
            renderSubtasks();
            updateProgress();
        }

        function deleteSubtask(index) {
            if (confirm('„Åì„ÅÆ„Çµ„Éñ„Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                appData[currentGoal.id].subtasks.splice(index, 1);
                saveData();
                renderSubtasks();
                updateProgress();
            }
        }

        function updateProgress() {
            const subtasks = appData[currentGoal.id].subtasks;
            const total = subtasks.length;
            const completed = subtasks.filter(st => st.completed).length;
            const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            document.getElementById('progressText').textContent = `ÈÄ≤Êçó: ${progress}%`;
            document.getElementById('progressCount').textContent = `${completed} / ${total} ÂÆå‰∫Ü`;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        function openSubtaskDetail(index) {
            currentSubtaskIndex = index;
            const subtask = appData[currentGoal.id].subtasks[index];
            
            const modal = document.getElementById('subtaskDetailModal');
            const content = modal.querySelector('.subtask-detail-content');
            
            content.innerHTML = '';
            
            const headerDiv = document.createElement('div');
            headerDiv.className = 'modal-header';
            headerDiv.innerHTML = `
                <h3 class="modal-title">${subtask.text}</h3>
                <button class="close-btn" onclick="closeSubtaskDetail()">√ó</button>
            `;
            content.appendChild(headerDiv);
            
            if (subtask.memo && subtask.memo.trim()) {
                const savedMemoDiv = document.createElement('div');
                savedMemoDiv.innerHTML = `
                    <h4 style="margin-bottom: 10px; color: #5d4037;">üìù ‰øùÂ≠ò„Åï„Çå„Åü„É°„É¢</h4>
                    <div class="saved-memo-display">${subtask.memo}</div>
                `;
                content.appendChild(savedMemoDiv);
            }
            
            const memoDiv = document.createElement('div');
            memoDiv.innerHTML = `
                <h4 style="margin-bottom: 10px; color: #5d4037;">üìù ${subtask.memo ? '„É°„É¢„ÇíÁ∑®ÈõÜ' : '„É°„É¢„ÇíËøΩÂä†'}</h4>
                <textarea class="memo-textarea" id="memoTextarea" placeholder="„É°„É¢„ÇíÂÖ•Âäõ...">${subtask.memo || ''}</textarea>
            `;
            content.appendChild(memoDiv);
            
            const urlDiv = document.createElement('div');
            urlDiv.innerHTML = `
                <h4 style="margin-bottom: 10px; color: #5d4037;">üîó „É™„É≥„ÇØ„ÉªURL</h4>
                <input type="text" class="url-input" id="urlInput" placeholder="URL„ÇíÂÖ•Âäõ...">
                <button class="add-btn" id="addUrlBtn" style="width: 100%; margin-bottom: 15px;">URL„ÇíËøΩÂä†</button>
                <div class="url-list" id="urlList"></div>
            `;
            content.appendChild(urlDiv);
            
            const saveBtn = document.createElement('button');
            saveBtn.className = 'save-memo-btn';
            saveBtn.textContent = '‰øùÂ≠ò';
            saveBtn.id = 'saveMemoBtn';
            content.appendChild(saveBtn);
            
            content.querySelector('#addUrlBtn').addEventListener('click', addUrl);
            content.querySelector('#saveMemoBtn').addEventListener('click', saveMemo);
            
            renderUrls();
            
            modal.classList.add('active');
        }

        function closeSubtaskDetail() {
            const memoTextarea = document.getElementById('memoTextarea');
            if (memoTextarea && currentGoal !== null && currentSubtaskIndex !== null) {
                const currentMemo = appData[currentGoal.id].subtasks[currentSubtaskIndex].memo || '';
                if (memoTextarea.value !== currentMemo) {
                    appData[currentGoal.id].subtasks[currentSubtaskIndex].memo = memoTextarea.value;
                    saveData();
                    renderSubtasks();
                }
            }
            document.getElementById('subtaskDetailModal').classList.remove('active');
            currentSubtaskIndex = null;
        }

        function saveMemo() {
            const memo = document.getElementById('memoTextarea').value;
            appData[currentGoal.id].subtasks[currentSubtaskIndex].memo = memo;
            const success = saveData();
            if (success) {
                closeSubtaskDetail();
            }
        }

        function addUrl() {
            const input = document.getElementById('urlInput');
            const url = input.value.trim();
            
            if (!url) return;
            
            appData[currentGoal.id].subtasks[currentSubtaskIndex].urls.push(url);
            saveData();
            renderUrls();
            input.value = '';
        }

        function renderUrls() {
            const list = document.getElementById('urlList');
            if (!list) return;
            
            list.innerHTML = '';
            
            const urls = appData[currentGoal.id].subtasks[currentSubtaskIndex].urls || [];
            
            urls.forEach((url, index) => {
                const div = document.createElement('div');
                div.className = 'url-item';
                div.innerHTML = `
                    <a href="${url}" target="_blank" class="url-link">${url}</a>
                    <button class="delete-url-btn" data-url-index="${index}">ÂâäÈô§</button>
                `;
                
                div.querySelector('.delete-url-btn').addEventListener('click', () => {
                    deleteUrl(index);
                });
                
                list.appendChild(div);
            });
        }

        function deleteUrl(index) {
            appData[currentGoal.id].subtasks[currentSubtaskIndex].urls.splice(index, 1);
            saveData();
            renderUrls();
        }

        let draggedElement = null;

        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            if (draggedElement !== this) {
                const fromIndex = parseInt(draggedElement.dataset.index);
                const toIndex = parseInt(this.dataset.index);
                
                const subtasks = appData[currentGoal.id].subtasks;
                const [removed] = subtasks.splice(fromIndex, 1);
                subtasks.splice(toIndex, 0, removed);
                
                saveData();
                renderSubtasks();
                updateProgress();
            }
            
            return false;
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            draggedElement = null;
        }

        function updateStats() {
            let totalGoals = 0;
            let completedGoals = 0;
            
            Object.values(goalsData).forEach(cat => {
                totalGoals += cat.goals.length;
                cat.goals.forEach(goal => {
                    const data = appData[goal.id];
                    if (data && data.completed) {
                        completedGoals++;
                    }
                });
            });
            
            document.getElementById('totalGoals').textContent = totalGoals;
            document.getElementById('completedGoals').textContent = completedGoals;
        }

        function toggleGoalComplete(goalId) {
            if (!appData[goalId]) {
                appData[goalId] = { subtasks: [], completed: false };
            }
            appData[goalId].completed = !appData[goalId].completed;
            saveData();
            renderCategories();
        }

        function addGoal(categoryKey) {
            const title = prompt('Êñ∞„Åó„ÅÑÁõÆÊ®ô„ÅÆ„Çø„Ç§„Éà„É´„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:');
            if (!title || !title.trim()) return;
            
            const icon = prompt('„Ç¢„Ç§„Ç≥„É≥„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ (ÁµµÊñáÂ≠ó):', '‚≠ê');
            
            const newId = categoryKey + '_custom_' + Date.now();
            goalsData[categoryKey].goals.push({
                id: newId,
                icon: icon || '‚≠ê',
                title: title.trim(),
                custom: true
            });
            
            appData[newId] = { subtasks: [], completed: false };
            saveData();
            renderCategories();
        }

        function editGoal(categoryKey, goalId) {
            const category = goalsData[categoryKey];
            const goalIndex = category.goals.findIndex(g => g.id === goalId);
            if (goalIndex === -1) return;
            
            const goal = category.goals[goalIndex];
            
            const newTitle = prompt('ÁõÆÊ®ô„ÅÆ„Çø„Ç§„Éà„É´„ÇíÁ∑®ÈõÜ:', goal.title);
            if (newTitle === null) return;
            
            const newIcon = prompt('„Ç¢„Ç§„Ç≥„É≥„ÇíÁ∑®ÈõÜ:', goal.icon);
            
            if (newTitle.trim()) {
                goal.title = newTitle.trim();
            }
            if (newIcon) {
                goal.icon = newIcon;
            }
            
            saveData();
            renderCategories();
        }

        function deleteGoal(categoryKey, goalId) {
            if (!confirm('„Åì„ÅÆÁõÆÊ®ô„Å®ÂÖ®„Å¶„ÅÆ„Çµ„Éñ„Çø„Çπ„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) return;
            
            const category = goalsData[categoryKey];
            const goalIndex = category.goals.findIndex(g => g.id === goalId);
            if (goalIndex === -1) return;
            
            category.goals.splice(goalIndex, 1);
            delete appData[goalId];
            
            saveData();
            renderCategories();
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            renderCategories();
            
            document.getElementById('subtaskInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addSubtask();
            });
            
            document.getElementById('goalModal').addEventListener('click', (e) => {
                if (e.target.id === 'goalModal') closeGoalModal();
            });
            
            document.getElementById('subtaskDetailModal').addEventListener('click', (e) => {
                if (e.target.id === 'subtaskDetailModal') closeSubtaskDetail();
            });
        });
    </script>
</body>
</html>
